---
title: "Data Cleaning Script"
format: html
---

```{r packages}
library(tidyverse)
```
```{r}
#Filter out Non Religious Organizations. Add Full Address Column to be Searched on. Trim Zip Code
eo_ny <- eo_ny|>
  filter(SUBSECTION == "03",
         FOUNDATION == "10")|>
  mutate(full_address = str_c(STREET, CITY, STATE, ZIP, sep = "_"),
         zip_code = str_extract(ZIP, pattern = "[0-9]{5}"))
```
```{r}
#Clean scraped zip code data from website

zip_codes|>
  mutate(row_num = row_number())|>
  filter(row_num == 14)|>
  unnest_longer(col = zip_scraped)|>
  filter(str_length(zip_scraped) > 1)|>
  mutate(zip_code = str_extract(zip_scraped, pattern = "[0-9]{5}"))|>
  mutate(city = str_remove(zip_scraped, pattern = "[0-9]{5}"))|>
  dplyr::select(zip_code, city) -> li_zip_codes
```
```{r}
#Filter eo_ny by zip code. 

li_churches <- li_zip_codes|>
  left_join(eo_ny, by = "zip_code")
```
```{r}
li_churches|>
  mutate(ntee_code = str_extract(NTEE_CD, pattern = "[0-9]{2}"),
         ntee_code = as.numeric(ntee_code))|>
  filter(is.na(ntee_code) | between(ntee_code, 20, 22))|>
  filter(!str_detect(NAME, regex("islam", ignore_case = TRUE)),
         !str_detect(NAME, regex("school", ignore_case = TRUE)),
         !str_detect(NAME, regex("trust", ignore_case = TRUE)),
         !str_detect(NAME, regex("israel", ignore_case = TRUE)),
         !str_detect(NAME, regex("synagogue", ignore_case = TRUE)),
         !str_detect(NAME, regex("quran", ignore_case = TRUE)),
         !str_detect(NAME, regex("synogogue", ignore_case = TRUE)),
         !str_detect(NAME, regex("masjid", ignore_case = TRUE)),
         !str_detect(NAME, regex("jew", ignore_case = TRUE)),
         !str_detect(NAME, regex("torah", ignore_case = TRUE)),
         !is.na(NAME))|>
  distinct(NAME, .keep_all = TRUE)-> li_churches
```

```{r}
#filter by coordinates
li_churches_coordinates|>
  unnest_longer(col = geo_loc)|>
  filter(!str_detect(geo_loc, pattern = "NA"))|>
  unnest_wider(col = geo_loc)|>
  distinct(EIN, .keep_all = TRUE)|>
  mutate(lat = as.numeric(lat),
    lon = as.numeric(lon))|>
  filter(between(lat, li_boundaries$min_lat, li_boundaries$max_lat),
         between(lon, li_boundaries$min_lon, li_boundaries$max_lon))-> map_data
```

```{r}
map_data_li|>
  summarize(max_lat = max(lat),
            min_lat = min(lat),
            max_lon = max(long),
            min_lon = min(long)) -> li_boundaries
```

```{r}
dhc_groups <- tibble(dhc_groups)

dhc_groups|>
  mutate(dhc_groups = na_if(dhc_groups, ""))|>
  drop_na()-> dhc_groups
```

```{r}
#get colnames from race web page variables
#race_web_page <- tibble(race_web_page)

#race_web_page |>
#  rename(web_info = race_web_page)|>
#  filter(str_detect(web_info, pattern = "^[P!]")) -> race_web_page

race_web_page |>
  filter(!str_detect(web_info, pattern = "^P8$"))|>
  pivot_wider(names_from = web_info, values_from = web_info)|>
  select(-starts_with("P"))|>
  mutate(GEO_ID = "GEOID",
         NAME = "NAME",
         -> race_cols
```

```{r}

```


